<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
</head>
<body>
  <h1>Nieghbors</h1>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>
  <script>
  
  queue()
    // .defer(d3.json, "/static/json/coords/bra/combined_5.json")
    .defer(d3.json, "/static/json/coords/bra/combined_7.json")
    // .defer(d3.json, "/static/json/coords/bra/combined_9.json")
    .awaitAll(ready);
  
  var munics;
  
  function ready(error, results) {
    // console.log(results)
    var bra = results[0];
    console.log(bra)
    
    bra.objects["locals"] = {"geometries":[]}
    var units = ["ac-meso", "al-meso", "am-meso", "ap-meso", "ba-meso", "ce-meso", "df-meso", "es-meso", "go-meso", "ma-meso", "mg-meso", "ms-meso", "mt-meso", "pa-meso", "pb-meso", "pe-meso", "pi-meso", "pr-meso", "rj-meso", "rn-meso", "ro-meso", "rr-meso", "rs-meso", "sc-meso", "se-meso", "sp-meso", "to-meso"];
    var units = ["ac-micro", "al-micro", "am-micro", "ap-micro", "ba-micro", "ce-micro", "df-micro", "es-micro", "go-micro", "ma-micro", "mg-micro", "ms-micro", "mt-micro", "pa-micro", "pb-micro", "pe-micro", "pi-micro", "pr-micro", "rj-micro", "rn-micro", "ro-micro", "rr-micro", "rs-micro", "sc-micro", "se-micro", "sp-micro", "to-micro"];
    // var units = ["ac-counties", "al-counties", "am-counties", "ap-counties", "ba-counties", "ce-counties", "df-counties", "es-counties", "go-counties", "ma-counties", "mg-counties", "ms-counties", "mt-counties", "pa-counties", "pb-counties", "pe-counties", "pi-counties", "pr-counties", "rj-counties", "rn-counties", "ro-counties", "rr-counties", "rs-counties", "sc-counties", "se-counties", "sp-counties", "to-counties"];
    units.forEach(function(s){
      bra.objects["locals"].geometries = bra.objects["locals"].geometries.concat(bra.objects[s].geometries)
      delete bra.objects[s]
    })

    munics = topojson.feature(bra, bra.objects["locals"]).features;
    munics = bra.objects["locals"].geometries;
    var neighbors = topojson.neighbors(bra.objects["locals"].geometries);

    // console.log(munics, neighbors.length)

    bra.objects["locals"].geometries.forEach(function(m, i){
      m["neighbors"] = []
      neighbors[i].forEach(function(n){
        m["neighbors"].push(bra.objects["locals"].geometries[n].id + "_" + bra.objects["locals"].geometries[n].properties.name)
      })
      if(m.id == "12"){
        console.log(m["neighbors"])
      }
    })

    // munics.forEach(function(m, i){
    //   // console.log(m.id)
    //   m["neighbors"] = []
    //   neighbors[i].forEach(function(n){
    //     m["neighbors"].push(munics[n].id)
    //   })
    //   console.log(m.id, m["neighbors"])
    //   if(m.id == "4mg030000"){
    //     console.log(m["neighbors"])
    //   }
    // })
    // console.log("Done!")
  }
  
  function print(){
    bra = {}
    munics.forEach(function(m, i){
      bra[m.id+"_"+m.properties.name] = m.neighbors;
    })
    console.log(JSON.stringify(bra))
  }
  
  </script>
</body>
</html>